{% extends "base.html" %}

{% block title %}Setup MFA - Fortress{% endblock %}

{% block content %}
<div class="auth-container">
    <div class="auth-card">
        <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem; margin-top: 1rem;">Setup Security</h1>
        <p class="auth-subtitle">Enable Two-Factor Authentication</p>

        <!-- Setup Card -->
        <div class="glass-card">
            
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <!-- QR Code Box -->
                <div style="background: white; padding: 1rem; display: inline-block; border-radius: 8px;">
                    <img src="data:image/png;base64,{{ qr_b64 }}" alt="MFA QR Code" style="width: 200px; height: 200px;">
                </div>
            </div>

            <!-- Instructions -->
            <div style="margin-bottom: 1.5rem;">
                <ol style="text-align: left; margin-left: 1.5rem; color: var(--text-muted); font-size: 0.9rem; line-height: 1.6;">
                    <li>Install <strong>Google Authenticator</strong> (or similar).</li>
                    <li>Scan the QR code above.</li>
                    <li>Enter the generated 6-digit code below.</li>
                </ol>
            </div>
            
            {% if error %}
            <div class="alert alert-error">
                <span>⚠️</span>
                <span>{{ error }}</span>
            </div>
            {% endif %}

            <form method="POST" action="/setup-mfa" class="auth-form">
                <!-- Pass the secret so we can verify it -->
                <input type="hidden" name="secret" value="{{ secret }}">
                
                <div class="form-group">
                    <input type="text" id="otp_code" name="otp_code" 
                           class="form-control otp-input" 
                           maxlength="6" pattern="[0-9]{6}" 
                           placeholder="000000" 
                           autocomplete="off"
                           required>
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    Activate & Login
                </button>
            </form>
            
            <!-- Manual Entry Backup -->
            <div class="mt-lg text-center">
                 <details>
                    <summary class="text-neon" style="cursor: pointer; font-size: 0.8rem;">Can't scan the code?</summary>
                    <p class="font-mono mt-sm" style="background: rgba(0,0,0,0.5); padding: 0.5rem; border-radius: 4px; border: 1px solid var(--border-glass);">
                        {{ secret }}
                    </p>
                 </details>
            </div>

        </div>
    </div>
</div>
{% endblock %}
